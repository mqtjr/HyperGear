<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Inventory Management - HyperGear</title>
</head>
<body class="bg-light">
    <%- include('partials/navbar') %>

  <div class="container-fluid my-4">
    <!-- Header Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h1 class="display-6 fw-bold text-primary">
              <i class="fas fa-boxes me-2"></i>Inventory Management
            </h1>
            <p class="text-muted mb-0">
              Welcome back, <span class="fw-semibold"><%= user.username %></span> 
              <span class="badge bg-primary ms-2"><%= user.role %></span>
            </p>
          </div>
          <div>
            <a href="/addProduct" class="btn btn-success btn-lg">
              <i class="fas fa-plus-circle me-2"></i>Add New Product
            </a>
          </div>
        </div>
      </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-body">
            <form method="GET" action="/inventory" class="mb-3">
              <div class="row g-3">
                <!-- Search Input -->
                <div class="col-md-4">
                  <div class="input-group">
                    <span class="input-group-text">
                      <i class="fas fa-search"></i>
                    </span>
                    <input type="text" 
                           class="form-control" 
                           name="search" 
                           value="<%= searchTerm %>"
                           placeholder="Search products...">
                  </div>
                </div>
                
                <!-- Stock Filter -->
                <div class="col-md-3">
                  <select class="form-select" name="stock">
                    <option value="all" <%= stockFilter === 'all' ? 'selected' : '' %>>All Products</option>
                    <option value="instock" <%= stockFilter === 'instock' ? 'selected' : '' %>>In Stock</option>
                    <option value="lowstock" <%= stockFilter === 'lowstock' ? 'selected' : '' %>>Low Stock (≤5)</option>
                    <option value="outofstock" <%= stockFilter === 'outofstock' ? 'selected' : '' %>>Out of Stock</option>
                  </select>
                </div>
                
                <!-- Sort Options -->
                <div class="col-md-2">
                  <select class="form-select" name="sort">
                    <option value="productName" <%= sortBy === 'productName' ? 'selected' : '' %>>Name</option>
                    <option value="quantity" <%= sortBy === 'quantity' ? 'selected' : '' %>>Stock</option>
                    <option value="price" <%= sortBy === 'price' ? 'selected' : '' %>>Price</option>
                    <option value="idProducts" <%= sortBy === 'idProducts' ? 'selected' : '' %>>ID</option>
                  </select>
                </div>
                
                <!-- Sort Order -->
                <div class="col-md-2">
                  <select class="form-select" name="order">
                    <option value="ASC" <%= sortOrder === 'ASC' ? 'selected' : '' %>>↑ Ascending</option>
                    <option value="DESC" <%= sortOrder === 'DESC' ? 'selected' : '' %>>↓ Descending</option>
                  </select>
                </div>
                
                <!-- Action Buttons -->
                <div class="col-md-1">
                  <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-filter"></i>
                  </button>
                </div>
              </div>
            </form>
            
            <!-- Quick Filter Buttons -->
            <div class="d-flex flex-wrap gap-2">
              <a href="/inventory" class="btn btn-outline-secondary btn-sm">
                <i class="fas fa-refresh me-1"></i>All
              </a>
              <a href="/inventory?stock=instock" class="btn btn-outline-success btn-sm">
                <i class="fas fa-check-circle me-1"></i>In Stock
              </a>
              <a href="/inventory?stock=lowstock" class="btn btn-outline-warning btn-sm">
                <i class="fas fa-exclamation-triangle me-1"></i>Low Stock
              </a>
              <a href="/inventory?stock=outofstock" class="btn btn-outline-danger btn-sm">
                <i class="fas fa-times-circle me-1"></i>Out of Stock
              </a>
            </div>
            
            <!-- Current Filters Display -->
            <% if (searchTerm || stockFilter !== 'all') { %>
              <div class="mt-3 pt-3 border-top">
                <small class="text-muted">Active filters:</small>
                <% if (searchTerm) { %>
                  <span class="badge bg-info ms-2">
                    Search: "<%= searchTerm %>"
                    <a href="/inventory?stock=<%= stockFilter %>" class="text-white ms-1">×</a>
                  </span>
                <% } %>
                <% if (stockFilter !== 'all') { %>
                  <span class="badge bg-secondary ms-2">
                    Stock: <%= stockFilter %>
                    <a href="/inventory?search=<%= searchTerm %>" class="text-white ms-1">×</a>
                  </span>
                <% } %>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
    <!-- Products Table -->
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <h5 class="card-title mb-0">
              <i class="fas fa-list me-2"></i>Product Inventory
            </h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0" id="inventoryTable">
                <thead class="table-dark">
                  <tr>
                    <th class="px-3">
                      <i class="fas fa-image me-1"></i>Image
                    </th>
                    <th>
                      <a href="/inventory?search=<%= searchTerm %>&stock=<%= stockFilter %>&sort=productName&order=<%= sortBy === 'productName' && sortOrder === 'ASC' ? 'DESC' : 'ASC' %>" 
                         class="text-white text-decoration-none">
                        <i class="fas fa-tag me-1"></i>Product Name
                        <% if (sortBy === 'productName') { %>
                          <i class="fas fa-sort-<%= sortOrder === 'ASC' ? 'up' : 'down' %> ms-1"></i>
                        <% } %>
                      </a>
                    </th>
                    <th class="text-center">
                      <a href="/inventory?search=<%= searchTerm %>&stock=<%= stockFilter %>&sort=quantity&order=<%= sortBy === 'quantity' && sortOrder === 'ASC' ? 'DESC' : 'ASC' %>" 
                         class="text-white text-decoration-none">
                        <i class="fas fa-warehouse me-1"></i>Stock
                        <% if (sortBy === 'quantity') { %>
                          <i class="fas fa-sort-<%= sortOrder === 'ASC' ? 'up' : 'down' %> ms-1"></i>
                        <% } %>
                      </a>
                    </th>
                    <th class="text-center">
                      <a href="/inventory?search=<%= searchTerm %>&stock=<%= stockFilter %>&sort=price&order=<%= sortBy === 'price' && sortOrder === 'ASC' ? 'DESC' : 'ASC' %>" 
                         class="text-white text-decoration-none">
                        <i class="fas fa-dollar-sign me-1"></i>Price
                        <% if (sortBy === 'price') { %>
                          <i class="fas fa-sort-<%= sortOrder === 'ASC' ? 'up' : 'down' %> ms-1"></i>
                        <% } %>
                      </a>
                    </th>
                    <th class="text-center">
                      <i class="fas fa-chart-line me-1"></i>Status
                    </th>
                    <th class="text-center">
                      <i class="fas fa-cogs me-1"></i>Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <% for(let i=0; i < products.length; i++) { %>
                    <tr class="product-row">
                      <!-- Product Image -->
                      <td class="px-3">
                        <img src="images/<%= products[i].image %>" 
                             alt="<%= products[i].productName %>"
                             class="img-thumbnail"
                             style="width: 60px; height: 60px; object-fit: cover;">
                      </td>
                      
                      <!-- Product Name -->
                      <td class="align-middle">
                        <a href="/product/<%= products[i].idProducts %>" 
                           class="text-decoration-none fw-semibold product-name">
                          <%= products[i].productName %>
                        </a>
                        <br>
                        <small class="text-muted">ID: #<%= products[i].idProducts %></small>
                      </td>
                      
                      <!-- Stock Quantity -->
                      <td class="text-center align-middle">
                        <span class="fs-5 fw-bold">
                          <%= products[i].quantity %>
                        </span>
                        <br>
                        <small class="text-muted">units</small>
                      </td>
                      
                      <!-- Price -->
                      <td class="text-center align-middle">
                        <span class="fs-5 fw-bold text-success">
                          $<%= Number(products[i].price).toFixed(2) %>
                        </span>
                      </td>
                      
                      <!-- Status Badge -->
                      <td class="text-center align-middle">
                        <% if (products[i].quantity === 0) { %>
                          <span class="badge bg-danger">
                            <i class="fas fa-times-circle me-1"></i>Out of Stock
                          </span>
                        <% } else if (products[i].quantity <= 5) { %>
                          <span class="badge bg-warning text-dark">
                            <i class="fas fa-exclamation-triangle me-1"></i>Low Stock
                          </span>
                        <% } else { %>
                          <span class="badge bg-success">
                            <i class="fas fa-check-circle me-1"></i>In Stock
                          </span>
                        <% } %>
                      </td>
                      
                      <!-- Actions -->
                      <td class="text-center align-middle">
                        <div class="btn-group" role="group">
                          <a href="/updateProduct/<%= products[i].idProducts %>" 
                             class="btn btn-outline-primary btn-sm"
                             data-bs-toggle="tooltip" 
                             title="Edit Product">
                            <i class="fas fa-edit"></i>
                          </a>
                          <button class="btn btn-outline-danger btn-sm" 
                                  onclick="confirmDelete('<%= products[i].idProducts %>', '<%= products[i].productName %>')"
                                  data-bs-toggle="tooltip" 
                                  title="Delete Product">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
            
            <% if (products.length === 0) { %>
              <!-- Empty State -->
              <div class="text-center py-5">
                <i class="fas fa-box-open text-muted" style="font-size: 4rem;"></i>
                <h4 class="mt-3 text-muted">No Products Found</h4>
                <p class="text-muted">Start by adding your first product to the inventory.</p>
                <a href="/addProduct" class="btn btn-primary">
                  <i class="fas fa-plus me-2"></i>Add Product
                </a>
              </div>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Minimal JavaScript -->
  <script>
    // Initialize tooltips
    document.addEventListener('DOMContentLoaded', function() {
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });
    });

    // Delete confirmation
    function confirmDelete(productId, productName) {
      if (confirm(`Are you sure you want to delete "${productName}"? This action cannot be undone.`)) {
        window.location.href = `/deleteProduct/${productId}`;
      }
    }
  </script>
</body>
</html>
