<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <title>Order Receipt - HyperGear</title>
</head>
<body class="bg-light">
  <%- include('partials/navbar') %>

  <div class="container my-5">
    <!-- Success Header -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="bg-success text-white p-4 rounded text-center">
          <div class="mb-3">
            <i class="fas fa-check-circle" style="font-size: 4rem;"></i>
          </div>
          <h2 class="mb-2">Order Placed Successfully!</h2>
          <p class="mb-0 fs-5">Thank you for your purchase, <%= user.username %>!</p>
        </div>
      </div>
    </div>

    <!-- Flash Messages -->
    <% if (messages.success && messages.success.length > 0) { %>
      <div class="row mb-3">
        <div class="col-12">
          <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i><%= messages.success[0] %>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        </div>
      </div>
    <% } %>

    <div class="row">
      <!-- Order Information -->
      <div class="col-lg-6 mb-4">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
              <i class="fas fa-info-circle me-2"></i>Order Information
            </h4>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-hashtag me-2 text-primary"></i>Order ID:</strong>
              </div>
              <div class="col-sm-6">
                <span class="badge bg-primary fs-6">#<%= order.id %></span>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-receipt me-2 text-info"></i>Order Number:</strong>
              </div>
              <div class="col-sm-6">
                <span class="font-monospace"><%= order.order_number %></span>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-calendar me-2 text-info"></i>Order Date:</strong>
              </div>
              <div class="col-sm-6">
                <%= new Date(order.created_at).toLocaleDateString() %> 
                <%= new Date(order.created_at).toLocaleTimeString() %>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-hourglass-half me-2 text-warning"></i>Status:</strong>
              </div>
              <div class="col-sm-6">
                <% if (order.status === 'pending') { %>
                  <span class="badge bg-warning text-dark">
                    <i class="fas fa-clock me-1"></i>Pending
                  </span>
                <% } else if (order.status === 'processing') { %>
                  <span class="badge bg-info">
                    <i class="fas fa-cog me-1"></i>Processing
                  </span>
                <% } else if (order.status === 'shipped') { %>
                  <span class="badge bg-primary">
                    <i class="fas fa-truck me-1"></i>Shipped
                  </span>
                <% } else if (order.status === 'delivered') { %>
                  <span class="badge bg-success">
                    <i class="fas fa-check-circle me-1"></i>Delivered
                  </span>
                <% } else if (order.status === 'cancelled') { %>
                  <span class="badge bg-danger">
                    <i class="fas fa-times-circle me-1"></i>Cancelled
                  </span>
                <% } else { %>
                  <span class="badge bg-secondary">
                    <i class="fas fa-question me-1"></i><%= order.status %>
                  </span>
                <% } %>
              </div>
            </div>
            
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-dollar-sign me-2 text-success"></i>Subtotal:</strong>
              </div>
              <div class="col-sm-6">
                <span class="text-success">$<%= Number(order.subtotal).toFixed(2) %></span>
              </div>
            </div>
            
            <% if (order.discount_amount > 0) { %>
            <div class="row mb-3">
              <div class="col-sm-6">
                <strong><i class="fas fa-percentage me-2 text-info"></i>Discount:</strong>
              </div>
              <div class="col-sm-6">
                <span class="text-info">-$<%= Number(order.discount_amount).toFixed(2) %></span>
              </div>
            </div>
            <% } %>
            
            <div class="row mb-0">
              <div class="col-sm-6">
                <strong><i class="fas fa-dollar-sign me-2 text-success"></i>Total Paid:</strong>
              </div>
              <div class="col-sm-6">
                <h4 class="text-success mb-0">$<%= Number(order.total_amount).toFixed(2) %></h4>
              </div>
            </div>
          </div>
        </div>

        <!-- Delivery Information -->
        <div class="card shadow-sm mt-4">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">
              <i class="fas fa-truck me-2"></i>Delivery Information
            </h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <strong><i class="fas fa-map-marker-alt me-2 text-danger"></i>Delivery Address:</strong>
              <p class="mt-1 mb-0 text-muted"><%= order.shipping_address %></p>
            </div>
          </div>
        </div>

        <!-- Order Status Information -->
        <div class="card shadow-sm mt-4 border-info">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">
              <i class="fas fa-info-circle me-2"></i>Order Status
            </h5>
          </div>
          <div class="card-body">
            <% if (order.status === 'pending') { %>
              <div class="alert alert-warning">
                <h6><strong><i class="fas fa-clock me-2"></i>Order Pending</strong></h6>
                <p class="mb-0">Your order is being reviewed and will be processed shortly.</p>
              </div>
            <% } else if (order.status === 'processing') { %>
              <div class="alert alert-info">
                <h6><strong><i class="fas fa-cog me-2"></i>Order Processing</strong></h6>
                <p class="mb-0">Your order is being prepared for shipment.</p>
              </div>
            <% } else if (order.status === 'shipped') { %>
              <div class="alert alert-primary">
                <h6><strong><i class="fas fa-truck me-2"></i>Order Shipped</strong></h6>
                <p class="mb-0">Your order has been shipped and is on its way to you.</p>
              </div>
            <% } else if (order.status === 'delivered') { %>
              <div class="alert alert-success">
                <h6><strong><i class="fas fa-check-circle me-2"></i>Order Delivered</strong></h6>
                <p class="mb-0">Your order has been successfully delivered!</p>
              </div>
            <% } else if (order.status === 'cancelled') { %>
              <div class="alert alert-danger">
                <h6><strong><i class="fas fa-times-circle me-2"></i>Order Cancelled</strong></h6>
                <p class="mb-0">This order has been cancelled.</p>
              </div>
            <% } %>
          </div>
        </div>
      </div>

      <!-- Order Items -->
      <div class="col-lg-6">
        <div class="card shadow-sm">
          <div class="card-header bg-secondary text-white">
            <h4 class="mb-0">
              <i class="fas fa-shopping-bag me-2"></i>Order Items
            </h4>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th class="px-3">Product</th>
                    <th class="text-center">Qty</th>
                    <th class="text-center">Price</th>
                    <th class="text-center">Total</th>
                  </tr>
                </thead>
                <tbody>
                  <% items.forEach(item => { %>
                    <% const itemTotal = Number(item.unit_price) * item.quantity; %>
                    <tr>
                      <td class="px-3 align-middle">
                        <div class="d-flex align-items-center">
                          <% if (item.image) { %>
                            <img src="/images/<%= item.image %>" 
                                 class="rounded me-3" 
                                 style="width: 50px; height: 50px; object-fit: cover;"
                                 alt="<%= item.productName %>">
                          <% } else { %>
                            <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                              <i class="fas fa-image text-muted"></i>
                            </div>
                          <% } %>
                          <div>
                            <strong><%= item.productName %></strong>
                            <% if (item.size || item.color) { %>
                              <br>
                              <small class="text-muted">
                                <% if (item.size) { %>Size: <%= item.size %><% } %>
                                <% if (item.size && item.color) { %>, <% } %>
                                <% if (item.color) { %>Color: <%= item.color %><% } %>
                              </small>
                            <% } %>
                          </div>
                        </div>
                      </td>
                      <td class="text-center align-middle">
                        <span class="badge bg-info"><%= item.quantity %></span>
                      </td>
                      <td class="text-center align-middle">
                        <span class="text-success">$<%= Number(item.unit_price).toFixed(2) %></span>
                      </td>
                      <td class="text-center align-middle">
                        <span class="text-primary fw-bold">$<%= itemTotal.toFixed(2) %></span>
                      </td>
                    </tr>
                  <% }) %>
                </tbody>
                <tfoot class="table-dark">
                  <tr>
                    <td colspan="3" class="px-3 fw-bold">
                      <i class="fas fa-calculator me-2"></i>Order Total:
                    </td>
                    <td class="text-center fw-bold fs-5">
                      $<%= Number(order.total_amount).toFixed(2) %>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>

        <!-- Next Steps -->
        <div class="card shadow-sm mt-4 border-success">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">
              <i class="fas fa-tasks me-2"></i>What's Next?
            </h5>
          </div>
          <div class="card-body">
            <div class="timeline">
              <div class="timeline-item completed">
                <i class="fas fa-check-circle text-success me-2"></i>
                <strong>Order Placed</strong> - Your order has been confirmed
              </div>
              <div class="timeline-item pending mt-2">
                <i class="fas fa-clock text-warning me-2"></i>
                <strong>Processing</strong> - We're preparing your items
              </div>
              <div class="timeline-item pending mt-2">
                <i class="fas fa-truck text-info me-2"></i>
                <strong>Shipping</strong> - Your order will be dispatched
              </div>
              <div class="timeline-item pending mt-2">
                <i class="fas fa-home text-primary me-2"></i>
                <strong>Delivered</strong> - Enjoy your purchase!
              </div>
            </div>
            
            <hr>
            
            <p class="text-muted mb-3">
              <i class="fas fa-info-circle me-1"></i>
              You will receive email updates about your order status.
            </p>
            
            <div class="d-grid gap-2">
              <a href="/shopping" class="btn btn-primary">
                <i class="fas fa-store me-2"></i>Continue Shopping
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    @media print {
      .navbar, .btn, .timeline-item.pending {
        display: none !important;
      }
      .card {
        border: 1px solid #000 !important;
        box-shadow: none !important;
      }
    }
  </style>
</body>
</html>
